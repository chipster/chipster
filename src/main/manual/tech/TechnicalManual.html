<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" dir="ltr" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- base href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=TechnicalManual" --></head><body class="mediawiki ltr ns-0 ns-subject page-TechnicalManual skin-sourceforge"><div style="background:#fff;border:1px solid #999;margin:-1px -1px 0;padding:0;"><div style="background:#ddd;border:1px solid #999;color:#000;font:13px arial,sans-serif;font-weight:normal;margin:12px;padding:8px;text-align:left">This is Google's cache of <a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=TechnicalManual" style="text-decoration:underline;color:#00c">http://sourceforge.net/apps/mediawiki/chipster/index.php?title=TechnicalManual</a>. It is a snapshot of the page as it appeared on 31 May 2014 09:35:41 GMT. The <a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=TechnicalManual" style="text-decoration:underline;color:#00c">current page</a> could have changed in the meantime. <a href="http://support.google.com/websearch/bin/answer.py?hl=en&amp;p=cached&amp;answer=1687222" style="text-decoration:underline;color:#00c">Learn more</a><br>Tip: To quickly find your search term on this page, press <b>Ctrl+F</b> or <b>âŒ˜-F</b> (Mac) and use the find bar.<br><br><div style="float:right"><a href="http://webcache.googleusercontent.com/search?q=cache:U1_CoICK37YJ:sourceforge.net/apps/mediawiki/chipster/index.php%3Ftitle%3DTechnicalManual&amp;client=firefox-a&amp;hl=en&amp;strip=1" style="text-decoration:underline;color:#00c">Text-only version</a></div>
<div>&nbsp;</div></div></div><div style="position:relative">


	
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta http-equiv="Content-Style-Type" content="text/css">
		<meta name="generator" content="MediaWiki 1.15.1">
		<meta name="keywords" content="TechnicalManual,ChipsterVsRVersions,LDAP,SADLFormat">
		<link rel="shortcut icon" href="http://sourceforge.net/favicon.ico">
		<link rel="search" type="application/opensearchdescription+xml" href="http://sourceforge.net/apps/mediawiki/chipster/opensearch_desc.php" title="chipster (en)">
		<link rel="alternate" type="application/rss+xml" title="chipster RSS Feed" href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=Special:RecentChanges&amp;feed=rss">
		<link rel="alternate" type="application/atom+xml" title="chipster Atom Feed" href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=Special:RecentChanges&amp;feed=atom">
		<title>SourceForge.net: TechnicalManual - chipster</title>
		<link rel="stylesheet" href="SourceForge.net:%20TechnicalManual%20-%20chipster_files/shared.html" type="text/css" media="screen">
		<link rel="stylesheet" href="SourceForge.net:%20TechnicalManual%20-%20chipster_files/commonPrint.html" type="text/css" media="print">
		<link rel="stylesheet" href="SourceForge.net:%20TechnicalManual%20-%20chipster_files/main.html" type="text/css" media="screen">
		<!--[if lt IE 5.5000]><link rel="stylesheet" href="/apps/mediawiki/chipster/skins/sourceforge/IE50Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 5.5000]><link rel="stylesheet" href="/apps/mediawiki/chipster/skins/sourceforge/IE55Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 6]><link rel="stylesheet" href="/apps/mediawiki/chipster/skins/sourceforge/IE60Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 7]><link rel="stylesheet" href="/apps/mediawiki/chipster/skins/sourceforge/IE70Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<link rel="stylesheet" href="SourceForge.net:%20TechnicalManual%20-%20chipster_files/index_003.html" type="text/css">
		<link rel="stylesheet" href="SourceForge.net:%20TechnicalManual%20-%20chipster_files/index_005.html" type="text/css" media="print">
		<link rel="stylesheet" href="SourceForge.net:%20TechnicalManual%20-%20chipster_files/index_002.html" type="text/css">
		<link rel="stylesheet" href="SourceForge.net:%20TechnicalManual%20-%20chipster_files/index_004.html" type="text/css">
		<!--[if lt IE 7]><script type="text/javascript" src="/apps/mediawiki/chipster/skins/common/IEFixes.js?207"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->

		<script type="text/javascript">/*<![CDATA[*/
		var skin = "sourceforge";
		var stylepath = "/apps/mediawiki/chipster/skins";
		var wgArticlePath = "/apps/mediawiki/chipster/index.php?title=$1";
		var wgScriptPath = "/apps/mediawiki/chipster";
		var wgScript = "/apps/mediawiki/chipster/index.php";
		var wgVariantArticlePath = false;
		var wgActionPaths = {};
		var wgServer = "http://sourceforge.net";
		var wgCanonicalNamespace = "";
		var wgCanonicalSpecialPageName = false;
		var wgNamespaceNumber = 0;
		var wgPageName = "TechnicalManual";
		var wgTitle = "TechnicalManual";
		var wgAction = "view";
		var wgArticleId = "38";
		var wgIsArticle = true;
		var wgUserName = null;
		var wgUserGroups = null;
		var wgUserLanguage = "en";
		var wgContentLanguage = "en";
		var wgBreakFrames = false;
		var wgCurRevisionId = 319;
		var wgVersion = "1.15.1";
		var wgEnableAPI = true;
		var wgEnableWriteAPI = true;
		var wgSeparatorTransformTable = ["", ""];
		var wgDigitTransformTable = ["", ""];
		var wgRestrictionEdit = [];
		var wgRestrictionMove = [];
		/*]]>*/</script>

		<script type="text/javascript" src="SourceForge.net:%20TechnicalManual%20-%20chipster_files/wikibits.html"><!-- wikibits js --></script>
		<!-- Head Scripts -->
		<script type="text/javascript" src="SourceForge.net:%20TechnicalManual%20-%20chipster_files/ajax.html"></script>
		<script type="text/javascript" src="SourceForge.net:%20TechnicalManual%20-%20chipster_files/index.html"><!-- site js --></script>
	

	<div id="globalWrapper">
		<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>
				<h1 id="firstHeading" class="firstHeading">TechnicalManual</h1>
		<div id="bodyContent">
			<h3 id="siteSub">From chipster</h3>
			<div id="contentSub"></div>
									<div id="jump-to-nav">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>			<!-- start content -->
			<table id="toc" class="toc" summary="Contents"><tbody><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="#Technical_manual_for_Chipster"><span class="tocnumber">1</span> <span class="toctext">Technical manual for Chipster</span></a>
<ul>
<li class="toclevel-2"><a href="#Introduction"><span class="tocnumber">1.1</span> <span class="toctext">Introduction</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#System_installation"><span class="tocnumber">2</span> <span class="toctext">System installation</span></a>
<ul>
<li class="toclevel-2"><a href="#Virtual_machine_installation"><span class="tocnumber">2.1</span> <span class="toctext">Virtual machine installation</span></a>
<ul>
<li class="toclevel-3"><a href="#Installing_virtualisation_software"><span class="tocnumber">2.1.1</span> <span class="toctext">Installing virtualisation software</span></a></li>
<li class="toclevel-3"><a href="#Instructions_for_VirtualBox"><span class="tocnumber">2.1.2</span> <span class="toctext">Instructions for VirtualBox</span></a>
<ul>
<li class="toclevel-4"><a href="#Download_Chipster_virtual_machine"><span class="tocnumber">2.1.2.1</span> <span class="toctext">Download Chipster virtual machine</span></a></li>
<li class="toclevel-4"><a href="#Add_Chipster_virtual_machine_to_VirtualBox"><span class="tocnumber">2.1.2.2</span> <span class="toctext">Add Chipster virtual machine to VirtualBox</span></a></li>
<li class="toclevel-4"><a href="#Configure_Chipster_virtual_machine"><span class="tocnumber">2.1.2.3</span> <span class="toctext">Configure Chipster virtual machine</span></a></li>
<li class="toclevel-4"><a href="#Start_Chipster_virtual_machine"><span class="tocnumber">2.1.2.4</span> <span class="toctext">Start Chipster virtual machine</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#Instructions_for_VMware_Player"><span class="tocnumber">2.1.3</span> <span class="toctext">Instructions for VMware Player</span></a>
<ul>
<li class="toclevel-4"><a href="#Download_Chipster_virtual_machine_2"><span class="tocnumber">2.1.3.1</span> <span class="toctext">Download Chipster virtual machine</span></a></li>
<li class="toclevel-4"><a href="#Add_Chipster_virtual_machine_to_VMware_Player"><span class="tocnumber">2.1.3.2</span> <span class="toctext">Add Chipster virtual machine to VMware Player</span></a></li>
<li class="toclevel-4"><a href="#Start_Chipster_virtual_machine_2"><span class="tocnumber">2.1.3.3</span> <span class="toctext">Start Chipster virtual machine</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#Instructions_for_KVM_.28libvirt.29"><span class="tocnumber">2.1.4</span> <span class="toctext">Instructions for KVM (libvirt)</span></a>
<ul>
<li class="toclevel-4"><a href="#Download_Chipster_virtual_machine_3"><span class="tocnumber">2.1.4.1</span> <span class="toctext">Download Chipster virtual machine</span></a></li>
<li class="toclevel-4"><a href="#Add_Chipster_virtual_machine"><span class="tocnumber">2.1.4.2</span> <span class="toctext">Add Chipster virtual machine</span></a></li>
<li class="toclevel-4"><a href="#Start_Chipster_virtual_machine_3"><span class="tocnumber">2.1.4.3</span> <span class="toctext">Start Chipster virtual machine</span></a></li>
<li class="toclevel-4"><a href="#Access_Chipster_virtual_machine"><span class="tocnumber">2.1.4.4</span> <span class="toctext">Access Chipster virtual machine</span></a></li>
<li class="toclevel-4"><a href="#Shutdown_Chipster_virtual_machine"><span class="tocnumber">2.1.4.5</span> <span class="toctext">Shutdown Chipster virtual machine</span></a></li>
</ul>
</li>
<li class="toclevel-3"><a href="#Instructions_for_OpenNebula"><span class="tocnumber">2.1.5</span> <span class="toctext">Instructions for OpenNebula</span></a></li>
<li class="toclevel-3"><a href="#Start_Chipster_client"><span class="tocnumber">2.1.6</span> <span class="toctext">Start Chipster client</span></a></li>
<li class="toclevel-3"><a href="#Configuring_Chipster"><span class="tocnumber">2.1.7</span> <span class="toctext">Configuring Chipster</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#System_installation_in_Linux"><span class="tocnumber">2.2</span> <span class="toctext">System installation in Linux</span></a></li>
<li class="toclevel-2"><a href="#Tool_installation_in_Linux"><span class="tocnumber">2.3</span> <span class="toctext">Tool installation in Linux</span></a>
<ul>
<li class="toclevel-3"><a href="#Manual_tool_installation"><span class="tocnumber">2.3.1</span> <span class="toctext">Manual tool installation</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Client_installation_in_Linux"><span class="tocnumber">2.4</span> <span class="toctext">Client installation in Linux</span></a></li>
<li class="toclevel-2"><a href="#Installation_in_Mac_OS_X"><span class="tocnumber">2.5</span> <span class="toctext">Installation in Mac OS X</span></a></li>
<li class="toclevel-2"><a href="#Installation_in_Windows"><span class="tocnumber">2.6</span> <span class="toctext">Installation in Windows</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#System_administration"><span class="tocnumber">3</span> <span class="toctext">System administration</span></a>
<ul>
<li class="toclevel-2"><a href="#Chipster_architecture"><span class="tocnumber">3.1</span> <span class="toctext">Chipster architecture</span></a>
<ul>
<li class="toclevel-3"><a href="#Server_components_explained"><span class="tocnumber">3.1.1</span> <span class="toctext">Server components explained</span></a></li>
<li class="toclevel-3"><a href="#Simple_server_installation"><span class="tocnumber">3.1.2</span> <span class="toctext">Simple server installation</span></a></li>
<li class="toclevel-3"><a href="#Advanced_server_installation"><span class="tocnumber">3.1.3</span> <span class="toctext">Advanced server installation</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Running_components"><span class="tocnumber">3.2</span> <span class="toctext">Running components</span></a></li>
<li class="toclevel-2"><a href="#Upgrading_server_installation"><span class="tocnumber">3.3</span> <span class="toctext">Upgrading server installation</span></a>
<ul>
<li class="toclevel-3"><a href="#Upgrading_VM_bundled_installation"><span class="tocnumber">3.3.1</span> <span class="toctext">Upgrading VM bundled installation</span></a></li>
<li class="toclevel-3"><a href="#Upgrading_other_installations"><span class="tocnumber">3.3.2</span> <span class="toctext">Upgrading other installations</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Directory_layout"><span class="tocnumber">3.4</span> <span class="toctext">Directory layout</span></a>
<ul>
<li class="toclevel-3"><a href="#Client"><span class="tocnumber">3.4.1</span> <span class="toctext">Client</span></a></li>
<li class="toclevel-3"><a href="#Server_on_Linux"><span class="tocnumber">3.4.2</span> <span class="toctext">Server on Linux</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Configuration_system"><span class="tocnumber">3.5</span> <span class="toctext">Configuration system</span></a>
<ul>
<li class="toclevel-3"><a href="#Configuring_Chipster_2"><span class="tocnumber">3.5.1</span> <span class="toctext">Configuring Chipster</span></a></li>
<li class="toclevel-3"><a href="#Loading_configuration_over_URL"><span class="tocnumber">3.5.2</span> <span class="toctext">Loading configuration over URL</span></a></li>
<li class="toclevel-3"><a href="#The_configuration_file"><span class="tocnumber">3.5.3</span> <span class="toctext">The configuration file</span></a></li>
<li class="toclevel-3"><a href="#Programming_API"><span class="tocnumber">3.5.4</span> <span class="toctext">Programming API</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Firewalls_and_proxies"><span class="tocnumber">3.6</span> <span class="toctext">Firewalls and proxies</span></a></li>
<li class="toclevel-2"><a href="#NAT"><span class="tocnumber">3.7</span> <span class="toctext">NAT</span></a></li>
<li class="toclevel-2"><a href="#Secure_communications"><span class="tocnumber">3.8</span> <span class="toctext">Secure communications</span></a>
<ul>
<li class="toclevel-3"><a href="#Setting_up_SSL"><span class="tocnumber">3.8.1</span> <span class="toctext">Setting up SSL</span></a></li>
<li class="toclevel-3"><a href="#Generating_SSL_keys"><span class="tocnumber">3.8.2</span> <span class="toctext">Generating SSL keys</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Authentication"><span class="tocnumber">3.9</span> <span class="toctext">Authentication</span></a>
<ul>
<li class="toclevel-3"><a href="#Users_file"><span class="tocnumber">3.9.1</span> <span class="toctext">Users file</span></a></li>
<li class="toclevel-3"><a href="#LDAP"><span class="tocnumber">3.9.2</span> <span class="toctext">LDAP</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1"><a href="#Server_components"><span class="tocnumber">4</span> <span class="toctext">Server components</span></a>
<ul>
<li class="toclevel-2"><a href="#Message_broker"><span class="tocnumber">4.1</span> <span class="toctext">Message broker</span></a></li>
<li class="toclevel-2"><a href="#File_broker"><span class="tocnumber">4.2</span> <span class="toctext">File broker</span></a>
<ul>
<li class="toclevel-3"><a href="#Metadata_database_backups"><span class="tocnumber">4.2.1</span> <span class="toctext">Metadata database backups</span></a>
<ul>
<li class="toclevel-4"><a href="#Restoring_metadata_database_backup"><span class="tocnumber">4.2.1.1</span> <span class="toctext">Restoring metadata database backup</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2"><a href="#Compute_service"><span class="tocnumber">4.3</span> <span class="toctext">Compute service</span></a>
<ul>
<li class="toclevel-3"><a href="#Compute_service_state_management"><span class="tocnumber">4.3.1</span> <span class="toctext">Compute service state management</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Authentication_service"><span class="tocnumber">4.4</span> <span class="toctext">Authentication service</span></a></li>
<li class="toclevel-2"><a href="#Manager_service"><span class="tocnumber">4.5</span> <span class="toctext">Manager service</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Tool_development"><span class="tocnumber">5</span> <span class="toctext">Tool development</span></a>
<ul>
<li class="toclevel-2"><a href="#Writing_Chipster_tools"><span class="tocnumber">5.1</span> <span class="toctext">Writing Chipster tools</span></a>
<ul>
<li class="toclevel-3"><a href="#Adding_and_modifying_tools"><span class="tocnumber">5.1.1</span> <span class="toctext">Adding and modifying tools</span></a></li>
<li class="toclevel-3"><a href="#Writing_SADL_header"><span class="tocnumber">5.1.2</span> <span class="toctext">Writing SADL header</span></a></li>
<li class="toclevel-3"><a href="#Making_R_scripts_Chipster_compatible"><span class="tocnumber">5.1.3</span> <span class="toctext">Making R scripts Chipster compatible</span></a></li>
<li class="toclevel-3"><a href="#Creating_manual_pages"><span class="tocnumber">5.1.4</span> <span class="toctext">Creating manual pages</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Describing_tools_with_SADL"><span class="tocnumber">5.2</span> <span class="toctext">Describing tools with SADL</span></a>
<ul>
<li class="toclevel-3"><a href="#Names"><span class="tocnumber">5.2.1</span> <span class="toctext">Names</span></a></li>
<li class="toclevel-3"><a href="#Input_and_output_files"><span class="tocnumber">5.2.2</span> <span class="toctext">Input and output files</span></a></li>
<li class="toclevel-3"><a href="#Parameters"><span class="tocnumber">5.2.3</span> <span class="toctext">Parameters</span></a></li>
<li class="toclevel-3"><a href="#Advanced_example"><span class="tocnumber">5.2.4</span> <span class="toctext">Advanced example</span></a></li>
<li class="toclevel-3"><a href="#Format_of_SADL_syntax_description"><span class="tocnumber">5.2.5</span> <span class="toctext">Format of SADL syntax description</span></a></li>
</ul>
</li>
<li class="toclevel-2"><a href="#Tool_conventions"><span class="tocnumber">5.3</span> <span class="toctext">Tool conventions</span></a>
<ul>
<li class="toclevel-3"><a href="#NGS_analysis_module"><span class="tocnumber">5.3.1</span> <span class="toctext">NGS analysis module</span></a></li>
<li class="toclevel-3"><a href="#Microarray_analysis_module"><span class="tocnumber">5.3.2</span> <span class="toctext">Microarray analysis module</span></a></li>
<li class="toclevel-3"><a href="#Sequence_analysis_module_.28Embster.29"><span class="tocnumber">5.3.3</span> <span class="toctext">Sequence analysis module (Embster)</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</td></tr></tbody></table><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
<a name="Technical_manual_for_Chipster" id="Technical_manual_for_Chipster"></a><h1> <span class="mw-headline"> Technical manual for Chipster </span></h1>
<p>The manual covers Chipster platform version 2.3 and later. It 
instructs in setting up your own Chipster server, adding your own tools 
into Chipster, and more. For the user manual, please see <a href="http://chipster.csc.fi/manual/" class="external free" title="http://chipster.csc.fi/manual/" rel="nofollow">http://chipster.csc.fi/manual/</a>.
</p>
<a name="Introduction" id="Introduction"></a><h2> <span class="mw-headline"> Introduction </span></h2>
<p>In the basic setup, Chipster is a client-server system. Chipster 
server can be run on a single server computer or even a laptop. The 
Chipster server itself actually contains multiple independent services, 
so it can be scaled across a cluster of servers to distribute 
computational and data transfer load.
</p><p>The system consists of compute, authentication and management 
services. The services are independent and connected by message and file
 brokers.
</p>
<a name="System_installation" id="System_installation"></a><h1> <span class="mw-headline"> System installation </span></h1>
<a name="Virtual_machine_installation" id="Virtual_machine_installation"></a><h2> <span class="mw-headline"> Virtual machine installation </span></h2>
<p>The recommended way to get Chipster server running is virtual machine
 installation. Chipster is packaged as complete virtual machine images 
that can be deployed to a variety of virtualisation platforms. The 
images are based on Ubuntu Linux 11.10 (Oneiric). Images are available 
in vmdk and qcow2 format, supporting essentially all virtualisation 
platforms. 
</p><p><b> To use the Chipster virtual machine, you need to:</b>
</p>
<ol><li> Install virtualisation software such as VirtualBox or VMware Player
</li><li> Download Chipster virtual machine
</li><li> Start the Chipster virtual machine
</li><li> Start Chipster client
</li></ol>
<p><br>
</p>
<a name="Installing_virtualisation_software" id="Installing_virtualisation_software"></a><h3> <span class="mw-headline"> Installing virtualisation software </span></h3>
<p>To run a virtual machine, you need a virtualisation software 
installed on the computer, which is going to run the virtual machine. 
VirtualBox and VMware Player are two common virtualisation software 
products, which work with Chipster.
</p>
<ul><li> <a href="https://www.virtualbox.org/" class="external text" title="https://www.virtualbox.org/" rel="nofollow">VirtualBox</a> for Linux, Mac and Windows, free
</li><li> <a href="http://www.vmware.com/products/desktop_virtualization/player/overview.html" class="external text" title="http://www.vmware.com/products/desktop_virtualization/player/overview.html" rel="nofollow">VMware Player</a> for Linux and Windows, free for personal non-commercial use
</li></ul>
<p>KVM, OpenNebula and VMware Enterprise are also supported.
</p><p><br>
</p>
<a name="Instructions_for_VirtualBox" id="Instructions_for_VirtualBox"></a><h3> <span class="mw-headline"> Instructions for VirtualBox </span></h3>
<a name="Download_Chipster_virtual_machine" id="Download_Chipster_virtual_machine"></a><h4> <span class="mw-headline"> Download Chipster virtual machine </span></h4>
<p>Download all the files from VirtualBox directory under the desired version from:
</p>
<ul><li> <a href="http://www.nic.funet.fi/pub/sci/molbio/chipster/dist/virtual_machines/" class="external free" title="http://www.nic.funet.fi/pub/sci/molbio/chipster/dist/virtual_machines/" rel="nofollow">http://www.nic.funet.fi/pub/sci/molbio/chipster/dist/virtual_machines/</a>
</li></ul>
<p>Note that the total size is around hundred gigabytes or more. 
</p>
<a name="Add_Chipster_virtual_machine_to_VirtualBox" id="Add_Chipster_virtual_machine_to_VirtualBox"></a><h4> <span class="mw-headline"> Add Chipster virtual machine to VirtualBox </span></h4>
<ul><li> Open VirtualBox
</li><li> Select "Machine"-&gt;"Add"
</li><li> Go to the folder where you downloaded Chipster virtual machine files and select chipster.vbox and "Open"
</li></ul>
<a name="Configure_Chipster_virtual_machine" id="Configure_Chipster_virtual_machine"></a><h4> <span class="mw-headline"> Configure Chipster virtual machine </span></h4>
<ul><li> Select "Settings" and "Network" and change the Attached to: 
Bridged Adapter (it's NAT by default, VirtualBox NAT does not yet work 
with Chipster)
<ul><li> Note: if you need to run Chipster server without any network, 
you can use "Host-only" network mode. Depending on your environment, you
 might need to first create a new host only network in VirtualBox 
Preferences.
</li></ul>
</li></ul>
<a name="Start_Chipster_virtual_machine" id="Start_Chipster_virtual_machine"></a><h4> <span class="mw-headline"> Start Chipster virtual machine </span></h4>
<ul><li> Select "Start"
<ul><li> <i>Note: In Mac environment, the presence of VMware tools in 
the image sometimes causes troubles during the boot (freezes with kernel
 panic). It is solved by a reboot. In future versions of the virtual 
machine VMware tools will disabled by default.</i>
</li></ul>
</li></ul>
<p><br>
</p>
<a name="Instructions_for_VMware_Player" id="Instructions_for_VMware_Player"></a><h3> <span class="mw-headline"> Instructions for VMware Player </span></h3>
<a name="Download_Chipster_virtual_machine_2" id="Download_Chipster_virtual_machine_2"></a><h4> <span class="mw-headline"> Download Chipster virtual machine </span></h4>
<p>Download all the files from VMware directory under the desired version from:
</p>
<ul><li> <a href="http://www.nic.funet.fi/pub/sci/molbio/chipster/dist/virtual_machines/" class="external free" title="http://www.nic.funet.fi/pub/sci/molbio/chipster/dist/virtual_machines/" rel="nofollow">http://www.nic.funet.fi/pub/sci/molbio/chipster/dist/virtual_machines/</a>
</li></ul>
<p>Note that the total size is around hundred gigabytes or more. 
</p>
<a name="Add_Chipster_virtual_machine_to_VMware_Player" id="Add_Chipster_virtual_machine_to_VMware_Player"></a><h4> <span class="mw-headline"> Add Chipster virtual machine to VMware Player </span></h4>
<ul><li> Run VMware Player
</li><li> Select "Open a virtual machine"
</li><li> Select chipster.vmx and 'Open'
</li></ul>
<a name="Start_Chipster_virtual_machine_2" id="Start_Chipster_virtual_machine_2"></a><h4> <span class="mw-headline"> Start Chipster virtual machine </span></h4>
<ul><li> Click "Play virtual machine"
</li><li> If you get a notification about missing VMware tools, just ignore it for now.
</li></ul>
<a name="Instructions_for_KVM_.28libvirt.29" id="Instructions_for_KVM_.28libvirt.29"></a><h3> <span class="mw-headline"> Instructions for KVM (libvirt) </span></h3>
<p>Unless you consider yourself a hacker, we recommend VirtualBox or VMware instead of KVM.
</p>
<a name="Download_Chipster_virtual_machine_3" id="Download_Chipster_virtual_machine_3"></a><h4> <span class="mw-headline"> Download Chipster virtual machine </span></h4>
<p>Download all the files from KVM directory under the desired version from:
</p>
<ul><li> <a href="http://www.nic.funet.fi/pub/sci/molbio/chipster/dist/virtual_machines/" class="external free" title="http://www.nic.funet.fi/pub/sci/molbio/chipster/dist/virtual_machines/" rel="nofollow">http://www.nic.funet.fi/pub/sci/molbio/chipster/dist/virtual_machines/</a>
</li></ul>
<p>Note that the total size is around hundred gigabytes or more. 
</p>
<a name="Add_Chipster_virtual_machine" id="Add_Chipster_virtual_machine"></a><h4> <span class="mw-headline"> Add Chipster virtual machine </span></h4>
<p>We are going to use bridged network. If you are using RedHat or 
Fedora Linux, you first need to disable NetworkManager, as it does not 
support bridged mode:
</p>
<pre>sudo service NetworkManager stop
sudo service network restart
</pre>
<p>Now we can add Chipster virtual machine, or domain, as it is called in <i>virsh</i> lingo.
</p>
<pre>sudo virsh iface-bridge &lt;YOUR NETWORK DEVICE&gt; brv
</pre>
<p>Next edit <i>chipster.xml</i> and update paths to disk images to the directory where you have put them. Paths need to be full.
</p><p>Now we can add the virtual machine (define domain):
</p>
<pre>sudo virsh define chipster.xml
</pre>
<a name="Start_Chipster_virtual_machine_3" id="Start_Chipster_virtual_machine_3"></a><h4> <span class="mw-headline"> Start Chipster virtual machine </span></h4>
<p>Start the virtual machine:
</p>
<pre>sudo virsh start chipster
</pre>
<p>Depending on your setup, you might get error stating that disk images cannot be read (Permission denied).
</p><p>To fix this, edit <i>/etc/libvirt/qemu.conf</i> and set <i>user=root</i> and <i>group=root</i>, then restart <i>libvirtd</i>:
</p>
<pre>sudo nano /etc/libvirt/qemu.conf 
sudo service libvirtd restart
</pre>
<p>Now you should able to start the domain
</p>
<a name="Access_Chipster_virtual_machine" id="Access_Chipster_virtual_machine"></a><h4> <span class="mw-headline"> Access Chipster virtual machine </span></h4>
<p>To access Chipster server console, use VNC:
</p>
<pre>vncviewer 0.0.0.0:27277
</pre>
<a name="Shutdown_Chipster_virtual_machine" id="Shutdown_Chipster_virtual_machine"></a><h4> <span class="mw-headline"> Shutdown Chipster virtual machine </span></h4>
<p>To shutdown the server, use:
</p>
<pre>sudo virsh shutdown chipster
</pre>
<p>To restore your original unbridged network configuration, use:
</p>
<pre>sudo virsh iface-unbridge brv
</pre>
<p>And in Red Hat or Fedora, restart NetworkManager:
</p>
<pre>sudo service NetworkManager start
sudo service network restart
</pre>
<p><br>
</p>
<a name="Instructions_for_OpenNebula" id="Instructions_for_OpenNebula"></a><h3> <span class="mw-headline"> Instructions for OpenNebula </span></h3>
<p>To get you started with OpenNebula integration, here is <i>.vmdef</i> template file to use as a reference:
</p>
<pre>NAME = chipster

CPU    = 8
VCPU   = 8
MEMORY = 8000

CONTEXT = [
#  INIT_SCRIPT_URL = "http://yourhost.com/init.sh",
  HOSTNAME = "chipster",
  AUTHORIZED_KEYS = ""
]


OS = [
    BOOT   = "hd",
    ARCH   = "x86_64"
]

DISK = [
  TYPE     = "disk",
  TARGET   = "vda",
  SOURCE   = "root.qcow2",
  DRIVER   = "qcow2"
]

DISK = [
  TYPE     = "disk",
  TARGET   = "vdb",
  SOURCE   = "scratch.qcow2",
  DRIVER   = "qcow2"
]

DISK = [
  TYPE     = "disk",
  TARGET   = "vdc",
  SOURCE   = "swap.qcow2",
  DRIVER   = "qcow2"
]

DISK = [
  TYPE     = "disk",
  TARGET   = "vdd",
  SOURCE   = "tools.qcow2",
  DRIVER   = "qcow2"
]

NIC = [ 
  network_id = "1",
#  ip         = "",
  model      = "virtio"
]

GRAPHICS = [ 
  TYPE    = "vnc",
#  KEYMAP  = &lt;your keymap&gt;,
  LISTEN  = "0.0.0.0"
]
</pre>
<p>Unlike in previous example, here we have less conservative CPU and memory settings.
</p><p>You can also specify full URL's as SOURCE of the disk images. That way machines can be booted from a centralised file server.
</p>
<a name="Start_Chipster_client" id="Start_Chipster_client"></a><h3> <span class="mw-headline"> Start Chipster client </span></h3>
Chipster servers are configured to start when the virtual machine is 
started. After you have the Chipster virtual machine running, start the 
Chipster client by pointing your web browser to <pre>http://&lt;hostname or IP address of the virtual machine&gt;:8081</pre>
 and clicking on the Launch Chipster link. Login with chipster/chipster.
 To get started, you can open an example session (link in Datasets 
panel).
<p>If you don't know the hostname or IP address of the virtual machine you have started, see instructions in the next section.
</p><p>If you fail to start the client, there is typically something 
wrong in the network settings. See next section on how to automatically 
reconfigure the network as a quick fix.
</p><p>Before starting to actually use Chipster, it is highly recommended to update the installation to get latest bug fixes. See <a href="#Upgrading_server_installation" title="">#Upgrading_server_installation</a>.
</p>
<a name="Configuring_Chipster" id="Configuring_Chipster"></a><h3> <span class="mw-headline"> Configuring Chipster </span></h3>
<ul><li> Login to VM using username: chipster, password: chipster
</li><li> Check the IP address of the vm
<ul><li> IP address is printed in the "message of the day" when you login
</li><li> Or you can use: <pre>hostname -I</pre> or <pre>ifconfig</pre>
</li></ul>
</li><li> For convenience, it is recommended to set the keyboard layout and time zone
<ul><li> Instructions are printed in "message of the day" when you login
</li></ul>
</li><li> Configure Chipster to use the given IP address:<pre>cd /opt/chipster;./configure.sh</pre>
</li><li> You can also use <pre>cd /opt/chipster;./configure.sh auto</pre> which auto detects the IP address and uses default values for other settings.
</li><li> Restart Chipster:<pre>service chipster restart</pre>
</li><li> Using a web browser go to the Chipster start page: <pre>http://&lt;vm ip address&gt;:8081</pre>
</li><li> For administering the OS installation of the virtual machine, "chipster" account has sudo rights
<ul><li> su or sudo rights are not required for running Chipster
</li><li> You can create a separate administration account and remove sudo rights from chipster
</li></ul>
</li></ul>
<a name="System_installation_in_Linux" id="System_installation_in_Linux"></a><h2> <span class="mw-headline"> System installation in Linux </span></h2>
<p>Chipster is easy to install also without using the virtual machine 
version. However that holds only for the system itself, as the large 
collection of analysis tools and their dependencies need quite a lot of 
work to set up.
</p><p><b>0) Requirements</b>
</p><p>Following software needs to be installed:
</p>
<ul><li> Java
</li><li> R statistical environment (optional)
</li></ul>
<p>For information on versions, see <a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=ChipsterVsRVersions" title="ChipsterVsRVersions">list of corresponding versions</a>.
</p><p>The following TCP ports need to be open in the firewall:
</p>
<ul><li> 61616 for message broker service
</li><li> 8080 for file broker service
</li><li> 8081 for webstart service (optional)
</li><li> 8082 for admin web console (optional)
</li></ul>
<p>See <a href="#Firewalls_and_proxies" title="">#Firewalls_and_proxies</a> for more information.
</p><p><b>1) Downloading and extracting</b>
</p><p>Installation packages can be obtained from <a href="http://chipster.sourceforge.net/downloads.shtml" class="external free" title="http://chipster.sourceforge.net/downloads.shtml" rel="nofollow">http://chipster.sourceforge.net/downloads.shtml</a>.
</p><p>After downloading extract the tar archive. It contains directory 
"chipster", where all components are in their own subdirectories. It can
 be placed anywhere, but usually <b>/opt/chipster</b> is used.
</p><p>Downloading and extraction can be done easily on command line (adjust version number 2.3.0 as needed):
</p>
<pre>cd /opt
wget http://www.nic.funet.fi/pub/sci/molbio/chipster/dist/versions/2.3.0/chipster-2.3.0.tar.gz
tar -xzf chipster-2.3.0.tar.gz</pre>
<p><br>
<b>2) Installing external tools</b>
</p><p>No external tools are needed to start the server environment, but
 for analysis tools to work, they are needed. You can skip this step if 
you just want to get the system running first. For instruction on 
installing the tools, see <a href="#Tool_installation_in_Linux" title="">#Tool_installation_in_Linux</a>.
</p><p><b>3) Configuring Chipster services</b>
</p><p>To configure the Chipster services, run the following two 
scripts. Both scripts will ask for confirmation before writing changes 
to files. Defaults should be fine for a local installation.
</p>
<pre>./configure.sh
./genpasswd.sh</pre>
<p><b>configure.sh</b> configures all the components, and <b>genpasswd.sh</b> generates secure passwords that server components use to authenticate each other.
</p><p><b>4) Starting and stopping service</b>s
</p><p>To start all the Chipster services, run:
</p>
<pre>./chipster start</pre>
<p>In addition to <b>start</b>, you can also use <b>stop</b>, <b>restart</b>, and <b>status</b>.
</p><p><br>
<b>5) Testing installation</b>
</p><p>To start the client using Java Web Start, go to the Web Start address specified when running the <b>configure.sh</b>. Default address is:
</p>
<pre>http://&lt;hostname&gt;:8081</pre>
<p><br>
To start the client locally (on the same machine as the services), run:
</p>
<pre>./client/bin/chipster-client</pre>
<p>The default username/password is chipster/chipster. Users can be added by editing the userlist at <b>auth/security/users</b>. Chipster also supports several more advanced authentication providers.
</p><p><br>
<b>6) Starting services at boot time</b>
</p><p>The steps needed to make services start at boot time are somewhat system dependent. In most Linux systems two steps are needed:
</p>
<ul><li> Make link from /etc/init.d/ to the executable of the service, for example <tt>/etc/init.d/chipster-auth -&gt; /opt/chipster/auth/bin/chipster-auth</tt>.
</li><li> Make links from /etc/rcX.d to the link at /etc/init.d to define the runlevels at which the service is started (typically 3).
</li></ul>
<p>You can also control Chipster as a single service
</p>
<ul><li> Make link from /etc/init.d/ to the Chipster service script chipster/chipster
</li></ul>
<p>In Red Hat Linux <tt>chkconfig</tt> can take care of creating the runlevel links, and you can use <tt>service &lt;service_name&gt; start | stop | status | console</tt> to control services.
</p><p>Please note that brokers must be started before other components 
can be started. This is taken care for you if you use the single service
 option.
</p>
<a name="Tool_installation_in_Linux" id="Tool_installation_in_Linux"></a><h2> <span class="mw-headline"> Tool installation in Linux </span></h2>
<p>One of the key ideas behind Chipster is to take all the high quality 
tools in the relevant field of data analysis and integrate them 
together. For the end user, this is great. Unfortunately for the person 
installing the system the situation is not that optimal. We really wish 
that substantial amount of the best data analysis algorithms were 
available in some clean, platform independent format and we could simply
 distribute them just like we distribute Chipster itself. But it is not 
reality, at least yet. So we have to face the facts and install 
different analysis applications the way the original author had in mind.
 
</p><p><b>For these reasons, we strongly recommend you to <a href="#Virtual_machine_installation" title="">choose the virtual machine based distribution</a> . There you have everything integrated and ready to run.</b>
</p>
<a name="Manual_tool_installation" id="Manual_tool_installation"></a><h3> <span class="mw-headline"> Manual tool installation </span></h3>
<p>It is also possible to install external applications and datasets by 
yourself. By external applications we mean the computational environment
 needed to run Chipster compute service. Chipster itself is plain Java 
and does not have any dependencies to external applications other than 
Java Runtime Environment. We do package Chipster with Tanuki Software's 
free Java Service Wrapper for convenience, but using the wrapper is not 
even required. So, without the external applications in place your 
compute service will boot up, but will not be able to run successfully 
any analysis jobs. If external applications are partially available, 
then you can use some of the tools, etc.
</p><p>External dependencies can be divided to 3 layers.
</p>
<ol><li> OS level packages
</li><li> external applications and databases (R and others)
</li><li> R packages
</li></ol>
<p>Level 1 contains a collection of operating system packages that are 
required for applications at levels 2 and 3 to work. Naturally level 1 
is OS specific and so the packages are installed into OS specific 
locations using OS specific tools (typically apt-get or yum). Levels 2 
and 3 are contained in the Chipster tools directory. The most important 
application at level 2 is R, as it hosts most of the analysis 
functionality and is also the basis for layer 3. There are also some 
simple databases, i.e. plain files, that reside on layer 2. The R 
specific layer 3 consist mostly of CRAN and Bioconductor packages, with 
some additional third party packages. They are installed using the 
standard R installation methods and will be located in <b>chipster/tools/R-&lt;version&gt;/library</b>. There is a setup tool for installing layer 3 automatically.
</p><p>Chipster tool directory or tool home is the place to store all external dependencies (except for OS packages). By default it is <b>/opt/chipster/tools</b>.
 Analysis scripts have access to tool directory path via a variable so 
that they can access external applications and databases. You need to 
configure tool home to <b>chipster/comp/conf/runtimes.xml</b> if you change it. 
</p><p><b>Up-to-date steps for installing all external applications and 
datasets can be found from the VM distribution installation script:</b>
</p><p><a href="https://github.com/chipster/chipster/blob/master/src/main/admin/vm/install-chipster.sh" class="external free" title="https://github.com/chipster/chipster/blob/master/src/main/admin/vm/install-chipster.sh" rel="nofollow">https://github.com/chipster/chipster/blob/master/src/main/admin/vm/install-chipster.sh</a>
</p><p>Follow steps onwards from <i>Install external applications and datasets</i>.
</p>
<a name="Client_installation_in_Linux" id="Client_installation_in_Linux"></a><h2> <span class="mw-headline"> Client installation in Linux </span></h2>
<p>Client installs automatically with Java Web Start.
</p>
<a name="Installation_in_Mac_OS_X" id="Installation_in_Mac_OS_X"></a><h2> <span class="mw-headline"> Installation in Mac OS X</span></h2>
<p>Chipster client is fully Mac OS X compatible and supported on Mac platforms. It installs automatically with Java Web Start.
</p><p>Chipster server supports Mac OS X. The installation is identical 
to Linux installation, so please refer there for instructions. We 
recommend virtual machine installation for the server environment in Mac
 OS X.
</p>
<a name="Installation_in_Windows" id="Installation_in_Windows"></a><h2> <span class="mw-headline"> Installation in Windows </span></h2>
<p>Chipster client is fully Windows compatible and supported on Windows platforms. It installs automatically with Java Web Start.
</p><p>Chipster server has experimental support for Windows. As the 
bioinformatics tool environment is Unix oriented, doing a complete 
installation in Windows will require significant efforts. We recommend 
virtual machine installation for the server environment in Windows.
</p>
<a name="System_administration" id="System_administration"></a><h1> <span class="mw-headline"> System administration </span></h1>
<a name="Chipster_architecture" id="Chipster_architecture"></a><h2> <span class="mw-headline"> Chipster architecture </span></h2>
<p>The shortest description for Chipster architecture would be that it 
is very flexible. The Chipster environment is based on message oriented 
architecture (called also message passing architecture or message 
oriented middleware architecture). Components are connected using 
message broker (ActiveMQ). This results in a loosely coupled distributed
 system. Chipster is designed to be based on the idea of broadcast, 
allowing components to be unaware of each other. Also the system does 
not depend on the protocol used for communication.
</p><p>The Chipster environment consists of the following components:
</p>
<ul><li> message broker (1 to many)
</li><li> file broker (1 to many)
</li><li> compute service (1 to many)
</li><li> authentication service (1)
</li><li> manager service (1 to many)
</li><li> client (many)
</li></ul>
<p>All components can be added or removed dynamically. In case there are
 multiple instances of a same component running there's no need for 
extra configuration, because, for example, multiple compute services can
 function without being aware of each other. This allows system 
administrator to add compute components on the fly if there is need for 
extra processing power. Currently the exception is that there can be 
only one authentication service.
</p><p>One of the key ideas in designing Chipster architecture was to 
carefully consider where each bit of the system's state is managed. 
Chipster client follows thick client paradigm where client is 
functionally rich. This decision was made to keep server environment 
simple and lightweight, to reduce number of messages, to distribute 
processing load (especially data visualisation) to clients and to allow 
improved user experience as client application is mostly independent of 
server components.
</p>
<a name="Server_components_explained" id="Server_components_explained"></a><h3> <span class="mw-headline"> Server components explained </span></h3>
<p>Message broker (ActiveMQ) acts as the central point of the system, 
passing messages between components. ActiveMQ supports broker 
distribution for improving scalability and reliability, so multiple 
brokers can be used simultaneously. 
</p><p>File broker distributes files to other components, acting as a 
supplement to message broker. File distribution is based on pull 
mechanism, where components go and retrieve files from the file broker. 
This way compute servers and clients can be behind firewalls. Using 
separate file broker also allows compute servers to use minimal disk 
space as files are cached at file server.
</p><p>Authenticator processes requests from clients. Each request is 
examined, and if valid session exists for that client it is allowed to 
continue. Otherwise a request is made for user to authenticate and after
 a successful authentication session is created. Authentication service 
supports many types of authentication sources (Unix passwd, JAAS, 
LDAP...), and can use them simultaneously. Server components 
authenticate to broker using server specific keys, and are allowed to 
communicate directly without going through the authenticator. 
Authentication service is a separate component so that it can be 
deployed inside intranet, as it might need access to sensitive 
information such as user databases.
</p><p>Compute service listens for computation requests. When client 
initiates a new task, all compute services with free resources reply and
 client decides which service gets to process the task. This way there 
is no single point of failure in distribution of tasks to server 
environment and compute services can be modified easily on fly.
</p>
<a name="Simple_server_installation" id="Simple_server_installation"></a><h3> <span class="mw-headline"> Simple server installation </span></h3>
<p>The simple way to install Chipster environment is to deploy all 
components to a single server and to distribute clients by using Java 
Web Start.
</p><p>All server components run inside their own directories, so having
 them on a single server does not require any special arrangements. 
Message broker and file broker are running in their respective ports, 
and other components connect to them using local network.
</p>
<a name="Advanced_server_installation" id="Advanced_server_installation"></a><h3> <span class="mw-headline"> Advanced server installation </span></h3>
<p>A good guideline for setting up advanced installation is to dedicate 
an untrusted server for message broker and file broker components, as 
they are the only components that have open server ports. That server 
should not be inside organisations firewall, i.e., be in DMZ network. To
 secure user credentials, authenticator should be installed separately 
on a strongly protected machine.
</p><p>It is possible to deploy multiple compute servers. All of them 
should have same tools descriptions, but it is possible to select active
 tools per server. It is also possible to configure maximum job counts. 
If you have many nodes available but they have also other use besides 
Chipster it is recommended to deploy compute servers on as many nodes as
 possible but limit the per server job count to keep Chipster from 
hogging all the resources. If there are memory intensive tools, it might
 be a good idea to deploy dedicated node for them with large memory and 
low maximum job count. Independent compute services can also be deployed
 to a batch processing system (LSF etc.), following a worker paradigm.
</p><p><br>
</p>
<a name="Running_components" id="Running_components"></a><h2> <span class="mw-headline"> Running components </span></h2>
<p>To start all the Chipster services, run switch to <b>/opt/chipster</b> and run:
</p>
<pre>./chipster start</pre>
<p>In addition to <b>start</b>, you can also use <b>stop</b>, <b>restart</b>, and <b>status</b>. Restart runs stop and start consecutively and status reports if the services are running (and what are their process ids).
</p><p>Script <b>chipster</b> is a high level tool for managing all 
services. It will check for each service the corresponding subdirectory 
and pass on the command. If subdirectory does not exist, then it will be
 skipped. This means that components can be removed from a certain node 
and <b>chipster</b> script can be still used to run the remaining ones.
</p><p>To control individual services, say restart compute service, use:
</p>
<pre>./comp/bin/chipster-comp restart</pre>
<p>So the script to run is in <b>bin</b> directory under the component directory and has component specific postfix.
</p><p>If you are using the virtual machine environment or otherwise configured Chipster as daemon, you can use <b>service</b> command from anywhere:
</p>
<pre>service chipster start</pre>
<p>Or to restart the compute service, use:
</p>
<pre>service chipster-comp restart</pre>
<p>So the service name is <b>chipster-&lt;component directory name&gt;</b>.
</p><p>If any of these give you error "Could not detect hardware 
architecture, please set platform manually.", it means that hardware 
architecture (which binary to run) was not detected automatically. It 
can be set manually by editing all instances of <b>chipster-generic.sh</b>.
 Architecture is configured by changing the PLATFORM line to match your 
hardware architecture (see comment above the line for options). To just 
get things running, you can use the architecture specific scripts under <b>&lt;component&gt;/bin/&lt;architecture&gt;/chipster-&lt;component&gt;</b>.
</p><p><br>
</p>
<a name="Upgrading_server_installation" id="Upgrading_server_installation"></a><h2> <span class="mw-headline"> Upgrading server installation </span></h2>
<a name="Upgrading_VM_bundled_installation" id="Upgrading_VM_bundled_installation"></a><h3> <span class="mw-headline"> Upgrading VM bundled installation </span></h3>
<p>Chipster VM bundle comes with an automatic update tool that allows 
you to update the installation without downloading everything again. 
Updates do not happen automatically, but must be initiated manually. 
Before the update, you should stop Chipster services.
</p>
<pre>./chipster stop
./update.sh
./chipster start
</pre>
<p><b>update.sh</b> script is just a bootstrap script that downloads the
 actual update script and executes it. This way the update system itself
 also gets updated when needed.
</p>
The actual update script is called update-exec.sh and is located at <pre>http://www.nic.funet.fi/pub/sci/molbio/chipster/dist/virtual_machines/updates/</pre>. When run, update-exec.sh downloads files, unpacks them, moves things around when needed and does other required setup steps.
<p>Chipster update system only manages Chipster installation and tool 
dependencies. You should also take care of keeping the operating system 
of the VM installation up to date, using normal Debian tools, such as 
aptitude.
</p>
<pre>sudo aptitude upgrade
</pre>
<p>Operating system packages get updated and a reboot might be necessary.
</p><p><br>
</p>
<a name="Upgrading_other_installations" id="Upgrading_other_installations"></a><h3> <span class="mw-headline"> Upgrading other installations </span></h3>
<p>If you installed Chipster yourself, then the automatic update 
mechanism is not available. The recommended approach is to make a fresh 
install of Chipster and move relevant functionality over from the 
previous installation. You should check at least these locations for 
things to move over:
</p>
<ul><li> chipster/*/conf/chipster-config.xml - custom configuration
</li><li> chipster/comp/conf/runtimes.xml - custom analysis tool runtimes
</li><li> chipster/comp/modules - custom tool scripts
</li><li> chipster/webstart/web-root/manual - custom manual pages
</li></ul>
<p>When Chipster is upgraded, also tool dependencies need updating. For 
exact details on changes between versions, look at the update-exec.sh 
script at <a href="http://www.nic.funet.fi/pub/sci/molbio/chipster/dist/virtual_machines/updates/" class="external free" title="http://www.nic.funet.fi/pub/sci/molbio/chipster/dist/virtual_machines/updates/" rel="nofollow">http://www.nic.funet.fi/pub/sci/molbio/chipster/dist/virtual_machines/updates/</a>.
</p>
<a name="Directory_layout" id="Directory_layout"></a><h2> <span class="mw-headline"> Directory layout </span></h2>
<p>Chipster directory layout is different on client and server sides. On
 client side the goal has been to make placement of files and 
directories compatitible with operating system specific conventions. On 
server side the goal has been to make the layout as coherent as possible
 (especially to integrate well into Java Service Wrapper that wraps all 
server components).
</p><p><br>
</p>
<a name="Client" id="Client"></a><h3> <span class="mw-headline"> Client </span></h3>
<p>Application data (logs, SSL keys, user preferences) is stored in a one place and user data (sessions, workflows) in another.
</p>
<ul><li> Windows
<ul><li> Application data stored in Local Settings\Application Data\Chipster inside user's home directory
</li><li> User data stored in My Documents inside user's home directory
</li></ul>
</li><li> Mac OS X
<ul><li> Application data stored in Library/Application Support/Chipster inside user's home directory
</li><li> User data stored in My Documents inside user's home directory
</li></ul>
</li><li> Linux/Unix
<ul><li> Application data stored in .chipster inside user's home directory
</li><li> User data stored in home directory, or Document or My Documents inside the home directory if they exist
</li></ul>
</li></ul>
<p>If operating system is not recognised, we fall back to Linux/Unix. This is because most often esoteric OS's are Unix variants.
</p><p><br>
</p>
<a name="Server_on_Linux" id="Server_on_Linux"></a><h3> <span class="mw-headline"> Server on Linux </span></h3>
<p>Typically Chipster is installed to <b>/opt/chipster</b>. Inside the 
installation directory there is a shared directory and several 
independent component directories (that depend on the shared directory).
 The contents of the shared directory are:
</p>
<pre>* chipster/shared
  * bin - generic executable files
  * lib - Java JAR and platform specific libraries
  * lib-src - source codes for libraries that require source code to be distributed together (LGPL)</pre>
<p>All of the component directories follow the same basic layout. The 
contents of the component directories are given below. "Wrapper" means 
here <a href="http://wrapper.tanukisoftware.org/" class="external text" title="http://wrapper.tanukisoftware.org/" rel="nofollow">Java Service Wrapper</a>, which is bundled with Chipster server installation.
</p>
<pre>* chipster/&lt;component name&gt;
  * bin - executable files and utility scripts
    * chipster-&lt;component name&gt; - main executable script (use this)
    * linux-x86-&lt;32 | 64&gt; - platform specific executables
      * chipster-&lt;component name&gt; - platform specific executable script
      * wrapper - wrapper binary
  * logs - log files for wrapper (console output) and Chipster itself
    * wrapper.log
    * chipster.log
    * messages.log
    * jobs.log
    * security.log
    * status.log
  * security - files related to encryption (and authentication on authentication service)
    * keystore.ks - automatically generated dummy key for SSL
    * users - flat file user database
  * conf - component's configuration
    * chipster-config.xml - main Chipster configuration
    * wrapper.conf - wrapper configuration
    * jaas.config - JAAS authenticator configuration
    * runtimes.xml - compute service runtime environments' configuration (compute service)
    * environment.xml - description of tool runtime environment (compute service)
  * file-root - www-root of file cache (file broker)
  * web-root - www-root of Web Start files (webstart service)
  * jobs-data - working directory for jobs (compute service)
  * modules - directory containing analysis tools (compute service)
    * microarray - microarray tools, in tool type specific subdirectories
       * R-&lt;version&gt;
       * bsh
       * java
       * microarray-module.xml - tool configuration for this module
    * ngs - NGS tools, in tool type specific subdirectories
       * R-&lt;version&gt;
       * java
       * ngs-module.xml - tool configuration for this module
    * sequence - sequence analysis tools, in tool type specific subdirectories
       * shell
       * sequence-module.xml - tool configuration for this module
    * &lt;third party modules&gt;
  * database - monitoring database (manager)
  * database-backups - backups for monitoring database (manager)</pre>
<p>ActiveMQ uses it's own directory layout. See <a href="http://activemq.apache.org/" class="external text" title="http://activemq.apache.org" rel="nofollow">ActiveMQ documentation</a> for more information.
</p>
<a name="Configuration_system" id="Configuration_system"></a><h2> <span class="mw-headline"> Configuration system </span></h2>
<a name="Configuring_Chipster_2" id="Configuring_Chipster_2"></a><h3> <span class="mw-headline"> Configuring Chipster </span></h3>
<p>If you just want to get your Chipster up and running, execute <b>configure.sh</b> script and your done! If you want to know more about Chipster configuration system, then read on.
</p><p>Chipster stores application configuration to a file called <b>chipster-config.xml</b>. It is located either in <b>conf</b>
 subdirectory or loaded dynamically via URL. The former approach is 
meant for server components and the latter for clients started over Java
 Web Start.
</p><p>Configuration is loaded in two steps. First an internal default configuration is loaded (<b>chipster-config-specification.xml,</b> located inside the Chipster JAR) and then the normal configuration file <b>chipster-config.xml</b>.
 The latter contains only information that needs to be set per instance 
basis, so it is quite minimalistic. However it is possible to overwrite 
configuration entries of the internal default configuration using the 
normal configuration file. Just include the entry in the file and it 
will replace the default one.
</p><p>The recommended way to configure a new Chipster instance is to use the <b>configure.sh</b>
 script located at the installation root directory. It will configure 
all the components and the Web Start client descriptor. You can also 
modify the configuration files manually. For information on meaning of 
the different configuration entries, please refer to <b><a href="https://github.com/chipster/chipster/blob/master/src/main/resources/chipster-config-specification.xml" class="external free" title="https://github.com/chipster/chipster/blob/master/src/main/resources/chipster-config-specification.xml" rel="nofollow">https://github.com/chipster/chipster/blob/master/src/main/resources/chipster-config-specification.xml</a></b> in the code repository.
</p>
<a name="Loading_configuration_over_URL" id="Loading_configuration_over_URL"></a><h3> <span class="mw-headline"> Loading configuration over URL </span></h3>
<p>Each Chipster component (client, analysis server, file broker etc.) 
has its own configuration file. If configuration file is not explicitly 
specified, <b>chipster-config.xml</b> is used. Configuration can be loaded over URL by passing an argument <b>-config &lt;url&gt;</b> at component startup. You can also specify a local file (e.g. <b>-config file:/path/to/config.xml</b>). For Web Start clients configuration file can be set in the <b>chipster.jnlp</b>
 descriptor file. Using this mechanism allows administrator to manage 
configuration centrally (such as the address of the broker server).
</p>
<a name="The_configuration_file" id="The_configuration_file"></a><h3> <span class="mw-headline"> The configuration file </span></h3>
<p>The configuration file <b>chipster-config.xml</b> contains all 
configuration entries that different components require. See below for 
an example configuration file of a file broker component.
</p>
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;configuration content-version="3"&gt;

    &lt;configuration-module moduleId="messaging"&gt;

        &lt;!-- host of message broker (JMS server ActiveMQ) to connect to --&gt;
        &lt;entry entryKey="broker-host"&gt;
            &lt;value&gt;&lt;/value&gt;
        &lt;/entry&gt;

        &lt;!-- protocol used to connect to message broker --&gt;
        &lt;entry entryKey="broker-protocol"&gt;
            &lt;value&gt;&lt;/value&gt;
        &lt;/entry&gt;

        &lt;!-- port used to connect to message broker --&gt;
        &lt;entry entryKey="broker-port"&gt;
            &lt;value&gt;&lt;/value&gt;
        &lt;/entry&gt;

    &lt;/configuration-module&gt;

    &lt;configuration-module moduleId="security"&gt;

        &lt;!-- username for authenticating connection to broker --&gt;
        &lt;entry entryKey="username"&gt;
            &lt;value&gt;filebroker&lt;/value&gt;
        &lt;/entry&gt;

        &lt;!-- password for authenticating connection to broker --&gt;
        &lt;entry entryKey="password"&gt;
            &lt;value&gt;filebroker&lt;/value&gt;
        &lt;/entry&gt;

    &lt;/configuration-module&gt;

    &lt;configuration-module moduleId="filebroker"&gt;

            &lt;!-- url of this file broker instance --&gt;
        &lt;entry entryKey="url"&gt;
            &lt;value&gt;http://chipster.example.com:8080&lt;/value&gt;
        &lt;/entry&gt;

        &lt;!-- server port to use in this file broker instance --&gt;
        &lt;entry entryKey="port"&gt;
            &lt;value&gt;8080&lt;/value&gt;
        &lt;/entry&gt;

    &lt;/configuration-module&gt;

&lt;/configuration&gt;</pre>
<p>The file contains several modules (XML element <b>configuration-module</b>), and the selection of modules varies between different components. Modules <b>security</b> and <b>messaging</b>
 are related to how Chipster node connects to messaging fabric and are 
always required. Additionally, there are node specific modules, such as <b>filebroker</b> in the example.
</p><p>Inside the module, there are configuration entries (XML element <b>entry</b>). Every entry has a key (XML attribute <b>entryKey</b>) and it contains one or more values (XML element <b>value</b>).
</p>
<a name="Programming_API" id="Programming_API"></a><h3> <span class="mw-headline"> Programming API </span></h3>
<p>Configuration can be accessed in Java code  as shown below.
</p>
<pre>DirectoryLayout.initialiseServerLayout(Arrays.asList(new String[] {}));
Configuration configuration = DirectoryLayout.getInstance().getConfiguration();</pre>
<p>First directory layout must be initialised. Here we initialised 
server layout and do not specify any node specific configuration modules
 that need to exist. Next we fetch a <b>fi.csc.microarray.config.Configuration</b> object that can be used to read configuration modules and entries.
</p>
<a name="Firewalls_and_proxies" id="Firewalls_and_proxies"></a><h2> <span class="mw-headline"> Firewalls and proxies </span></h2>
<p>In a typical setup, the following TCP ports need to be open in the firewall:
</p>
<ul><li> 61616 for message broker service (Openwire or Openwire/SSL)
</li><li> 8080 for file broker service (HTTP or HTTP/SSL)
</li><li> 8081 for webstart service, optional (HTTP or HTTP/SSL) 
</li><li> 8082 for admin web console, optional (HTTP or HTTP/SSL)
</li></ul>
<p>One of the design guidelines in Chipster was to make it easily 
adaptable to various firewall configurations. Even though there are many
 server components, only message and file brokers are listening to open 
ports. In other words, they act as a hub to which other components 
connect to. Both of the components are designed so that they can be 
installed on a "untrusted" machine located in the DMZ. Compute and 
authentication services often have to be located inside intranet, which 
is not a problem as they do not act as servers from a networking point 
of view.
</p><p>Client uses TCP or SSL to connect to message and file brokers. 
This communication can be configured to ports 80 and 443 to bypass 
strict firewalls. In some high security environments practically all 
network access is disabled, except for HTTP using local proxy. Currently
 Chipster does not use HTTP, so in this extreme case deployment is not 
possible without changes to firewall configuration. However routing 
messages through HTTP is supported by ActiveMQ message broker, so in 
future these scenarios might also be supported directly.
</p><p>By default Chipster ignores Java proxy settings and always uses 
direct connection. Is is so because many proxies are not truly HTTP/1.1 
compatible and mess up communication. It is possible the disable the 
override and make Chipster to use Java proxy settings. In 
chipster-config.xml, add the following under the module messaging:
</p>
<pre>&lt;entry entryKey="disable-proxy" type="boolean" description="should we ignore Java proxy settings and connect directly"&gt;
&lt;value&gt;false&lt;/value&gt;
&lt;/entry&gt;</pre>
<p>The change needs to made to chipster-config.xml of clients. In normal
 setups it is served by webstart server and will be in effect when 
clients are restarted. 
</p><p><br>
</p>
<a name="NAT" id="NAT"></a><h2> <span class="mw-headline"> NAT </span></h2>
<p>Sometimes the server environment needs to be installed behind NAT 
(network address translation). This usually happens when the server 
environment connects to internal network, which is not visible to public
 internet. To make the system accessible externally, NAT host is added 
that directs traffic between internal and external networks. Nowadays 
such a setup if typical especially for cloud installation (e.g. 
OpenStack based environment).
</p><p>Operating through NAT makes network configuration more 
complicated, because servers need to bind to different addresses that 
they should be connected to. Chipster supports operation through NAT, 
but needs some manual tweaks to configuration after running the 
automatic configuration script.
</p><p>Required steps are:
</p>
<ul><li> Run configure.sh
<ul><li> Use internal address for message broker (ActiveMQ) host
</li><li> Use external address for file broker host
</li></ul>
</li><li> Edit webstart/web-root/chipster.jnlp and change all occurrences of internal address to external address
</li><li> Edit webstart/web-root/chipster-config.xml and change all occurrences of internal address to external address
</li></ul>
<p>Internal address is the actual IP or host name of the node that the 
server is running on. External address is the NAT'ed externally visible 
IP or host name that is mapped to the internal address. Same port 
numbers must be used internally and externally.
</p><p><br>
</p>
<a name="Secure_communications" id="Secure_communications"></a><h2> <span class="mw-headline"> Secure communications </span></h2>
<a name="Setting_up_SSL" id="Setting_up_SSL"></a><h3> <span class="mw-headline"> Setting up SSL </span></h3>
<p>By default Chipster server installation uses plain TCP for 
communication. Setting up SSL is not trivial when using Java's default 
implementation, so it is not done by default. However here you'll find 
instructions on how to do it.
</p><p><b>Step 1. Locate keystore</b>
</p><p>You can either use the keystore.ks dummy keystore that is bundled with Chipster clients and generate your own (see <a href="#Generating_SSL_keys" title="">#Generating_SSL_keys</a>). Save it to file keystore.ks.
</p><p><b>Step 2. Configure message broker</b>
</p><p>You need to:
</p>
<ul><li> copy keystore.ks to chipster/activemq/conf
</li><li> open chipster/activemq/bin/&lt;platform&gt;/wrapper.conf and edit the following settings (uncomment if needed)
<ul><li> javax.net.ssl.keystorePassword=microarray (or whatever you have used)
</li><li> javax.net.ssl.keystore=%ACTIVEMQ_BASE/conf/keystore.ks
</li></ul>
</li><li> open chipster/activemq/conf/activemq.xml and change protocol to "ssl" (you can change port also)
</li></ul>
<p><b>Step 3. Configure Chipster components</b>
</p><p>For each of the server components, you need to:
</p>
<ul><li> copy keystore.ks to chipster/&lt;component&gt;/security
</li><li> open chipster/&lt;component&gt;/conf/chipster-config.xml and 
in module "messaging" change protocol to "ssl" (you can change port 
also)
</li></ul>
<p>That's it. You also need to change setting in the module "security" if you have used other than default values; see <a href="#Generating_SSL_keys" title="">#Generating_SSL_keys</a> for more details.
</p><p>If the client application fails to start with 
UnknownHostException, the problem is that hostname cannot be resolved on
 the workstation. Java SSL requires that hostnames can be resolved for 
both endpoints. This can happen in Linux, so try "host foobar" on shell.
 If it says "host not found" your network is a bit problematic. You can 
add "foobar" to your /etc/hosts after localhost, like "127.0.0.1 
localhost foobar", and it should work. You can also contact system 
administrator to find out why your hostname cannot be resolved.
</p><p>Some international versions of the Java Runtime do not have all 
the strong security components in place. If this is the case, you will 
get "RSA premaster secret error" when trying to run Chipster server. 
Installing "Java Cryptography Extension (JCE) Unlimited Strength 
Jurisdiction Policy Files" should fix it. They can be installed using 
your system's package manager (if available there) or from <a href="http://java.oracle.com/" class="external text" title="http://java.oracle.com" rel="nofollow">Oracle Java</a> site.
</p>
<a name="Generating_SSL_keys" id="Generating_SSL_keys"></a><h3> <span class="mw-headline"> Generating SSL keys </span></h3>
<p>Chipster comes with dummy keystore that gets you going with SSL. If 
you want to use SSL not only for encrypting communication but also for 
establishing trust between server components and clients, you have to 
replace these publicly available keys with your own ones. Chipster uses 
Java's built-in SSL implementation. Keystore can be manipulated as 
explained in <a href="http://java.sun.com/security/reference/docs/" class="external text" title="http://java.sun.com/security/reference/docs/" rel="nofollow">Java Security documentation</a>, so you can also use your existing keys.
</p><p>Here we describe how you can generate your own SSL keys. Please 
note that these keys are not approved by any Certificate Authority, and 
cause warnings if used outside of Chipster environment.
</p><p><b>Step 1.</b> Generate a new keystore
</p><p>Keys can be generated using Java's keytool-application.
</p><p>Generate key using keytool:
</p>
<pre>keytool -genkey -alias your_key_alias -dname "cn=Your name or organisation, ou=Your name or organisation, o=Your name or organisation, c=your_country_code" -validity 1800 -keyalg RSA -keystore keystore.ks</pre>
<p>keytool will ask your keystore password (twice). You can choose any 
name (alias) for the key and you can use any password you want. The 
dummy keystore uses "client" as key alias and "microarray" as keystore 
password.
</p><p>Next we need to set up trust for the newly generated key. It is done by exporting and importing the certificate.
</p>
<pre>keytool -exportcert -alias your_key_alias -file cert -keystore keystore.ks
keytool -importcert -alias your_trusted_key_alias -file cert -keystore keystore.ks</pre>
<p>You can choose any name (alias) for the trusted key. The dummy 
keystore uses "microarray" and that is also the default in Chipster SSL 
configuration.
</p><p><br>
<b>Step 2.</b> Distribute keystore
</p><p>Chipster components have subdirectory <b>security</b> where keystore is stored in file keystore.ks, and ActiveMQ message broker stores keystore in <b>conf</b>
 subdirectory. You can replace it with your newly generated keystore. If
 you wish to establish trust between different Chipster components, you 
should generate at least two dedicated keys: one for clients and one for
 server components. You might also generate a dedicated key for each 
server component.
</p><p><b>Step 3.</b> Update configuration
</p><p>After deploying new keystore you have to configure modules to 
understand them. If you used default trusted key alias or keystore 
password, no changes are required. Keystore related settings are placed 
to configuration module <b>security</b>, in configuration file <b>chipster-config.xml</b>.
</p>
<pre>&lt;configuration-module moduleId="security" description="encryption and authentication"&gt;
  &lt;entry entryKey="keystore" type="string" description="keystore file for SSL"&gt;
    &lt;value&gt;${chipster_security_dir}/keystore.ks&lt;/value&gt;
  &lt;/entry&gt;

  &lt;entry entryKey="keypass" type="string" description="keystore password for SSL"&gt;
    &lt;value&gt;microarray&lt;/value&gt;
  &lt;/entry&gt;

  &lt;entry entryKey="keyalias" type="string" description="alias of key to be used for SSL"&gt;
    &lt;value&gt;microarray&lt;/value&gt;
  &lt;/entry&gt;

        ...
</pre>
<p>Default configuration does not have SSL specific settings, so you need to add those entries. You should update values for <b>keypass</b> and <b>keyalias</b>
 to reflect appropriate settings for each component. The key alias 
refers to the trusted key, not the private key. The alias of the private
 key needs not to be configured, but the key needs to be in the keystore
 anyway. You can also change keystore path if you don't wish to store 
the keystore inside the <b>security</b> directory.
</p>
<a name="Authentication" id="Authentication"></a><h2> <span class="mw-headline"> Authentication</span></h2>
<a name="Users_file" id="Users_file"></a><h3> <span class="mw-headline"> Users file </span></h3>
<p>The simplest supported authentication mechanism is the user file in <b>auth/security/users</b>. The format is:
</p>
<pre>&lt;username&gt;:&lt;password&gt;:&lt;exp. date as YYYY-MM-DD&gt;:comment
</pre>
<p>Only username and password are required. Blank lines and comment lines starting with <b>#</b> are allowed.
</p>
<a name="LDAP" id="LDAP"></a><h3> <span class="mw-headline"> LDAP </span></h3>
<p>See <a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=LDAP" title="LDAP">Authentication via LDAP</a>.
</p>
<a name="Server_components" id="Server_components"></a><h1> <span class="mw-headline"> Server components </span></h1>
<p>Chipster server components can be divided into services and brokers. 
Services are independent components that perform tasks related to their 
roles. They do not use server socket and for that reason can be deployed
 behind a firewall. When services are started, they "call back" to 
broker components that take care of communication between the services. 
Broker components do use server sockects.
</p><p>Look at #Directory_layout to see where each of the components is located on the Chipster installation.
</p>
<a name="Message_broker" id="Message_broker"></a><h2> <span class="mw-headline"> Message broker </span></h2>
<p>Message broker is the hub of the system. It is based on the ActiveMQ server that implements the JMS standard. 
</p><p>Message broker is required. Logically there is only one message 
broker. ActiveMQ also supports clusters of brokers, so that the message 
broker can be run on multiple servers for improved performance and fault
 tolerance.
</p>
<a name="File_broker" id="File_broker"></a><h2> <span class="mw-headline"> File broker </span></h2>
<p>File broker is the central file repository of the system. It is based
 on the Jetty server and uses HTTP or HTTPS protocols for communication.
</p><p>File broker is required. There can be one or more file brokers in
 the system. When file brokers are added, clients and services start to 
distribute files randomly on the available file brokers.
</p><p><br>
</p>
<a name="Metadata_database_backups" id="Metadata_database_backups"></a><h3> <span class="mw-headline"> Metadata database backups </span></h3>
<p>Metadata database is part of file broker starting from Chipster 3.0.
</p><p>By default metadata database is backed up 10 past midnight 
everyday and 100 backups are kept by deleting oldest backups as needed. 
This results in having daily backups for about 3 months time.
</p><p>You can change metadata backup settings in <tt>fileserver/conf/chipster-config.xml</tt>.
</p>
<a name="Restoring_metadata_database_backup" id="Restoring_metadata_database_backup"></a><h4> <span class="mw-headline"> Restoring metadata database backup </span></h4>
<ul><li> Stop chipster filebroker <tt>service chipster-fileserver stop</tt> or <tt>/opt/chipster/fileserver/bin/linux-x86-64/chipster-fileserver stop</tt>
</li><li> Delete corrupted or old database <tt>db-root/ChipsterFilebrokerMetadataDatabase</tt> 
</li><li> Copy backed up database <tt>metadata-backups/filebroker-metadata-db-backup-yyyy-mm-dd_hh-mm:ss/ChipsterFilebrokerMetadataDatabase</tt> to <tt>db-root</tt>
</li><li> Restart chipster filebroker <tt>service chipster-fileserver start</tt> or <tt>/opt/chipster/fileserver/bin/linux-x86-64/chipster-fileserver start</tt>
</li></ul>
<p>It is also possible to restore a backup by using certain connection 
URL attributes, but at the moment that requires changing the java code. 
See <a href="http://db.apache.org/derby/docs/10.9/adminguide/cadminhubbkup98797.html" class="external free" title="http://db.apache.org/derby/docs/10.9/adminguide/cadminhubbkup98797.html" rel="nofollow">http://db.apache.org/derby/docs/10.9/adminguide/cadminhubbkup98797.html</a> for more information.
</p>
<a name="Compute_service" id="Compute_service"></a><h2> <span class="mw-headline"> Compute service </span></h2>
<p>Compute service takes care of all processing (tools in the client). 
It calls various backend applications and runtimes to do the actual 
computation.
</p><p>Compute service is required. There can be many of them. Typically
 compute service is the only component that is distributed over multiple
 servers. When multiple services are added, clients negotiate with them 
and take care of load distribution over the services.
</p>
<a name="Compute_service_state_management" id="Compute_service_state_management"></a><h3> <span class="mw-headline"> Compute service state management </span></h3>
<p>The simplest way to run compute service is to make it completely 
stateless. For each job, it fetches inputs, does the processing and 
uploads outputs to file broker.
</p><p>For better performance, compute service can access file broker 
repository directly (both inputs and outputs). By default the service 
will access files on the file broker directly from disk if they are 
installed on the same server. To disable the optimisation, you can clear
 the following entry from <b>chipster/comp/config/chipster-config.xml</b>:
</p>
<pre>&lt;entry entryKey="local-filebroker-user-data-path" type="string" description="path to local filebroker's user data directory"&gt;
&lt;value&gt;&lt;/value&gt;
&lt;/entry&gt;</pre>
<p>Compute service cleans up after each job. For debugging purposes this can be disabled by adding the following entry to <b>comp</b> module in <b>chipster/comp/config/chipster-config.xml</b>:
</p>
<pre>&lt;entry entryKey="sweep-work-dir" type="boolean"&gt;
&lt;value&gt;false&lt;/value&gt;
&lt;/entry&gt;</pre>
<a name="Authentication_service" id="Authentication_service"></a><h2> <span class="mw-headline"> Authentication service </span></h2>
<p>Authentication service checks each message from client, requests 
authentication if needed and forwards them to authenticated area. JMS 
message topics in Chipster are divided into unauthenticated and 
authenticated. Only server components can write to authenticated topics,
 so all client messaging needs to pass through authentication service to
 be picked up by other server components.
</p><p>Authentication service is required. There can be only one of them in the installation.
</p>
<a name="Manager_service" id="Manager_service"></a><h2> <span class="mw-headline"> Manager service </span></h2>
<p>Manager server listens to the logging topics and writes log 
information to a database. It also offers web interfaces for accessing 
the database and monitoring the system.
</p><p>Manager service is not required. In principle there can be multiple services running, but that would not be very useful.
</p>
<a name="Tool_development" id="Tool_development"></a><h1> <span class="mw-headline"> Tool development </span></h1>
<a name="Writing_Chipster_tools" id="Writing_Chipster_tools"></a><h2> <span class="mw-headline"> Writing Chipster tools </span></h2>
<p>Basically, you have to do three things:
</p>
<ul><li> provide the tool itself (command line executable, R script, Java class etc.)
</li><li> write a tool description in <a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=SADLFormat" title="SADLFormat">SADLFormat</a>, so that the script can be run and shown in the client application
</li><li> make compute service aware of the tool
</li></ul>
<p>You should also follow <a href="#Tool_conventions" title="">conventions for Chipster analysis tools</a>.
</p>
<a name="Adding_and_modifying_tools" id="Adding_and_modifying_tools"></a><h3> <span class="mw-headline"> Adding and modifying tools </span></h3>
<p>Chipster tools are divided into modules. Modules are high level 
packages that cover some specific area of data analysis, such as next 
generation sequencing. At compute server,
modules are stored in <b>chipster/comp/modules</b> directory. Each 
module has its own subdirectory, where the tools are located in tool 
type specific subdirectories. 
Tools can be R scripts, BeanShell scripts, or header stubs that define 
how command line tools are invoked etc. Besides the tools themselves, 
each module has a 
configuration file <b>&lt;module name&gt;-module.xml</b> that lists all 
tools, maps them to runtimes (configured at compute service level) and 
gives tool specific parameters, if needed.
</p><p>To get started, go and have a look at the <b>modules</b> 
directory. Changes to tool files are detected dynamically, so you can 
make a change and see what happens when you run the tool in the client. 
Changes to tool code do not require any restarting, allowing you to 
write and test tools simultaneously. However, please note that changes 
to tool headers and module configuration files require client and 
compute service restart. 
</p>
<a name="Writing_SADL_header" id="Writing_SADL_header"></a><h3> <span class="mw-headline"> Writing SADL header </span></h3>
<p>SADL (Simple Analysis Description Language) is a simple notation for 
describing analysis tools so that they can be used in Chipster 
environment. SADL describes what input files the tool takes, what output
 files it produces, and what parameters are needed for running it. For 
the syntax of SADL please see <a href="#Describing_tools_with_SADL" title="">#Describing_tools_with_SADL</a>
</p><p>The way how SADL is embedded into script is script type specific.
 For example, in R scripts you start each line with hash (#), the 
comment notation of R. The SADL snippet must be the first thing in the 
script and there must not be any empty lines in it.
</p>
<a name="Making_R_scripts_Chipster_compatible" id="Making_R_scripts_Chipster_compatible"></a><h3> <span class="mw-headline"> Making R scripts Chipster compatible </span></h3>
<p>Chipster uses regular R scripts. The only thing to remember is that interactive functions can not be used.
</p><p>Before running the script, the system runs the following initialisation snippet:
</p>
<pre>setwd(".")</pre>
<p>The script should output results in table format to a file specified in description header. So, for example like this:
</p>
<pre>write.table(mytable, file="results.txt", quote=FALSE, col.names=FALSE, row.names=FALSE)</pre>
<a name="Creating_manual_pages" id="Creating_manual_pages"></a><h3> <span class="mw-headline"> Creating manual pages </span></h3>
<p>Manual pages are being delivered from the webstart server:
</p>
<pre>/opt/chipster/webstart/web-root/manual/</pre>
<p>Chipster client maps manual pages to tools by using the ID of the 
tool. Postfix, if present, is removed and replaced with ".html". So if 
you have a tool with ID "example_tool.R", you need to create manual page
 called "example_tool.html" to the <b>manual</b> folder. Pages are shown
 in user's default browser, so all available web tricks can be used. 
Supporting material, like images, can be stored in the same directory or
 a subdirectory can be created.
</p>
<a name="Describing_tools_with_SADL" id="Describing_tools_with_SADL"></a><h2> <span class="mw-headline">Describing tools with SADL</span></h2>
<p>SADL (Simple Analysis Description Language) is a simple notation for 
describing analysis tools so that they can be used in the Chipster 
framework. SADL describes what input files the tool takes, what output 
files it produces, and what parameters are needed to run it. In Chipster
 inputs are selected by user, clicking on datasets at the GUI. 
Parameters are used to create the parameter panel, and outputs are the 
datasets produced by the tool. 
</p><p>In SADL, each line describes one thing. General format of a line 
is: 1) what it is 2) optionality 3) internal name 4) display name 5) 
type 6) type details 7) description. By default inputs and parameters 
are required to be set by the user, but they can also be declared 
optional. All display names are in quotes and descriptions are in 
parentheses, but they can be omitted when the string does not contain 
whitespace or operator characters. The required order of the lines is: 
TOOL, INPUT*, OUTPUT*, PARAMETER*. Example of a SADL description for an 
simple concatenation tool is given below.
</p><p><br>
</p>
<pre>TOOL concat.R: "Concatenate tool" (Concatenates two files.)
INPUT file1.txt: "First input" TYPE GENERIC (First file to concatenate.)
INPUT file2.txt: "Second input" TYPE GENERIC (Second file to concatenate.)
OUTPUT concatenated.txt: "Concatenated file" (The concatenated result file.)
</pre>
<p>The concatenation tool is very simple. It defines the tool name and 
description and then the two inputs we are going to concatenate and, 
finally, the single output. Read further to understand the syntax that 
is used to define names (first there is the technical name, a colon and 
then the human readable name).
</p><p><br>
</p>
<a name="Names" id="Names"></a><h3> <span class="mw-headline">Names</span></h3>
<p>All names in SADL have same syntax. They can have two parts: ID 
(technical name) and human readable name (shown in GUI). ID's should not
 be changed without a very good reason, as they are used to identify 
tools, parameters etc. in the Chipster framework. Especially for users' 
workflows to remain valid it is best to not change the ID's. Human 
readable names can be changed freely.
</p><p>Example of name without and with human readable part:
</p>
<pre>p_value
p_value: "The P-value"
</pre>
<p>The ID part of the name can be followed by colon and human readable 
name. ID is required, but human readable name is not. Both parts are 
typically in parentheses, but they can be omitted, if the name is a 
simple string without spaces or operator characters.
</p>
<a name="Input_and_output_files" id="Input_and_output_files"></a><h3> <span class="mw-headline">Input and output files</span></h3>
<p>Inputs are the data files that are being processed, and outputs are 
the results that are returned to user as data files. Input and output 
definition formats are:
</p>
<pre>INPUT (META) (OPTIONAL) name TYPE type (description)
OUTPUT (META) (OPTIONAL) name TYPE type (description)
</pre>
<p>File names follow the normal conventions, with one addition. File name can contain the special string <b>{...}</b>,
 which makes it an input file set. Chipster binds all matching inputs 
and gives them names with numbering 1... replacing the special string.
</p><p>Type information is not currently used, except for backwards compatibility in some older tools. Currently type <b>GENERIC</b> should be used always. In future it will be replaced by a more fine grained and flexible system (type tagging).
</p>
<a name="Parameters" id="Parameters"></a><h3> <span class="mw-headline">Parameters</span></h3>
<p>Parameters allow user to tune behavior of an analysis tool. They are 
shown in the graphical parameter panel in the Chipster user interface 
and stored to variables or given as arguments when running the tool.
</p><p>Parameter definition format is:
</p>
<pre>PARAMETER (OPTIONAL) name TYPE type FROM min_value TO max_value DEFAULT def_value (description)</pre>
<p><b>FROM</b>, <b>TO</b> and <b>DEFAULT</b> are optional. Description can be left blank.
</p><p>Valid parameter types are:
</p>
<ul><li> INTEGER
<ul><li> For integer values
</li><li> Represented as a text box in GUI
</li></ul>
</li><li> DECIMAL
<ul><li> For decimal values
</li><li> Represented as a text box in GUI
</li></ul>
</li><li> PERCENT
<ul><li> For percentages (integer from between 0 - 100)
</li><li> Might be removed in future, if there is no need for this
</li><li> Represented as a slider in GUI
</li></ul>
</li><li> STRING
<ul><li> For free string values
</li><li> Represented as a text box in GUI
</li></ul>
</li><li> [key1:val1, key1:val2, key1:val3]
<ul><li> For enumerated values (selection from a predefined list)
</li><li> Valid values are given in block parenthesis
</li><li> Represented as a drop-down list in GUI
</li><li> First part of the name is the actual technical value of the selection, is second part is given it is used in the GUI
</li></ul>
</li><li> COLUMN_SEL
<ul><li> For selecting one column from the input dataset
</li><li> Possible values are read from the input dataset
<ul><li> In case of multiple inputs, present in all of them
</li></ul>
</li><li> Can also be empty
</li><li> Represented as a drop-down list in GUI
</li></ul>
</li><li> METACOLUMN_SEL
<ul><li> For selecting one column from the phenodata
</li><li> Behaves exactly like COLUMN_SEL, but uses phenodata as input dataset
</li></ul>
</li></ul>
<p>Numeric parameters allow also minimum and maximum values to be set, by using keywords <b>FROM</b> and <b>TO</b>  after the parameter type. For enumeration type, <b>FROM</b> and <b>TO</b> can be used to specify the minimum and maximum number of selections the user can make (by default one selection can be made).
</p><p>All parameters allow a default value, which is given by using the keyword <b>DEFAULT</b>.
 The default value must be a valid value for the parameter. User 
interface implements validity checking in real time, so writing "one" to
 a <b>INTEGER</b> text box or "10" to a <b>INTEGER</b> text box with maximum of 5 results in immediate error shown in the parameter panel side and run button being blocked.
</p>
<a name="Advanced_example" id="Advanced_example"></a><h3> <span class="mw-headline">Advanced example</span></h3>
<p>Below is an example of an imaginery tool that highlights all different features that can be described with the language.
</p>
<pre>TOOL util-test.R: "Test tool" (This tool description is shown to the user in the GUI (note that certain operators must be escaped\).)
INPUT microarray{...}.tsv: "Raw data files" TYPE CDNA (A set of 1 or more raw data files that are given as input.)
INPUT META phenodata.tsv: "Experiment description" TYPE GENERIC (Meta-level description of the input files.)
OUTPUT result.txt: "Result file" (The output file that this tool always produces.)
OUTPUT OPTIONAL warnings.txt: "Warning file" (The tool might produce warnings while running and then they are returned also.)
PARAMETER value1: "The first value" TYPE INTEGER FROM 0 TO 200 DEFAULT 10 (Description of this parameter)
PARAMETER OPTIONAL value2: "The second value" TYPE DECIMAL FROM 0 TO 200 DEFAULT 20.2 (Description of this parameter)
PARAMETER method: "The method" TYPE [linear: "Linear scale", logarithmic: "Logarithmic scale"] DEFAULT logarithmic (Description of this parameter)
PARAMETER genename: "Gene name" TYPE STRING DEFAULT at_1234 (Description of this parameter)
PARAMETER key: "Key column" TYPE COLUMN_SEL (Which column is used as a key)
</pre>
<a name="Format_of_SADL_syntax_description" id="Format_of_SADL_syntax_description"></a><h3> <span class="mw-headline">Format of SADL syntax description</span></h3>
<p>For geek users, a more formal syntax defination is below. It is in 
the form of rewrite rules. First rule in the list is the initial rule 
where rewriting is started. Quoted texts are snippets of SADL. For 
example, TOOL is a term that is rewritten using the given rules, but 
"TOOL" is a string that should be found in the source code. 
Operators&nbsp;?, +, * and | have their common semantics. The canonical 
syntax definition in maintained in the Javadoc documentation of the 
class SADLSyntax.
</p>
<pre>-&gt; TOOL+
TOOL -&gt; "TOOL" NAME DESCRIPTION INPUT* OUTPUT* PARAMETER*
INPUT -&gt; "INPUT" META? OPTIONALITY? NAME "TYPE" TYPE_NAME DESCRIPTION
OUTPUT -&gt; "OUTPUT" META? OPTIONALITY? NAME DESCRIPTION
PARAMETER -&gt; "PARAMETER" OPTIONALITY? NAME "TYPE" PARAMETER_TYPE PARAMETER_FROM? PARAMETER_TO? PARAMETER_DEFAULT? DESCRIPTION 
PARAMETER_TYPE -&gt; TOKEN | PARAMETER_TYPE_ENUM
PARAMETER_TYPE_ENUM -&gt; "[" PARAMETER_TYPE_ENUM_ELEMENTS "]"
PARAMETER_TYPE_ENUM_ELEMENTS -&gt; NAME | NAME "," PARAMETER_TYPE_ENUM_ELEMENTS
PARAMETER_FROM -&gt; "FROM" TOKEN
PARAMETER_TO -&gt; "TO" TOKEN
PARAMETER_DEFAULT -&gt; "DEFAULT" PARAMETER_DEFAULT_ELEMENT
PARAMETER_DEFAULT_ELEMENT -&gt; TOKEN | TOKEN "," PARAMETER_DEFAULT_ELEMENT 
OPTIONALITY -&gt; "OPTIONAL"
META -&gt; "META"
NAME -&gt; TOKEN | TOKEN ":" TOKEN
DESCRIPTION -&gt; TOKEN
TYPE_NAME -&gt; TOKEN (see SADLSyntax.InputType for declaration, implementations pluggable)
TOKEN -&gt; any single token produced by tokeniser
</pre>
<a name="Tool_conventions" id="Tool_conventions"></a><h2> <span class="mw-headline"> Tool conventions </span></h2>
<p>The goal in Chipster is to always produce a coherent user experience.
 Here are some conventions that can be useful when integrating tools 
into Chipster and should be followed when writing tools that are to be 
integrated into Chipster main repository.
</p>
<a name="NGS_analysis_module" id="NGS_analysis_module"></a><h3> <span class="mw-headline"> NGS analysis module </span></h3>
<ul><li> Tools should accept and produce read data in FASTQ and BAM format when possible
</li></ul>
<a name="Microarray_analysis_module" id="Microarray_analysis_module"></a><h3> <span class="mw-headline"> Microarray analysis module </span></h3>
<ul><li> The default data format is TSV (tab separated values), with one row for each gene or probeset
</li><li> The first column should be unnamed or "identifier" and contain the gene/probeset name
</li><li> Tool should not remove any existing columns unless the row 
structure is changed. In other words, inputs can have annotation etc. 
data that just passes through analysis steps
</li><li> See AnalysisToolInputsAndOutputs for more information
</li></ul>
<a name="Sequence_analysis_module_.28Embster.29" id="Sequence_analysis_module_.28Embster.29"></a><h3> <span class="mw-headline"> Sequence analysis module (Embster)</span></h3>
<ul><li> Follow EMBOSS conventions
</li></ul>

<!-- 
NewPP limit report
Preprocessor node count: 227/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key p_chipster_mediawiki:pcache:idhash:38-0!1!0!!en!2!edit=0 and timestamp 20140531093540 -->
<div class="printfooter">
Retrieved from "<a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=TechnicalManual">http://sourceforge.net/apps/mediawiki/chipster/index.php?title=TechnicalManual</a>"</div>
						<!-- end content -->
						<div class="visualClear"></div>
		</div>
	</div>
		</div>
		<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
	
				 <li id="ca-nstab-main" class="selected"><a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=TechnicalManual" title="View the content page [c]" accesskey="c">Page</a></li>
				 <li id="ca-talk" class="new"><a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=Talk:TechnicalManual&amp;action=edit&amp;redlink=1" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				 <li id="ca-viewsource"><a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=TechnicalManual&amp;action=edit" title="This page is protected.
You can view its source [e]" accesskey="e">View source</a></li>
				 <li id="ca-history"><a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=TechnicalManual&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li>			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<table style="height: 4px;" rules="none" border="0" cellpadding="0" cellspacing="0"></table>
			<ul>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
		<a style="background-image: url(/apps/mediawiki/chipster/nfs/project/c/ch/chipster/7/70/MediaWikiSidebarLogo.png);" href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=Main_Page" title="Visit the main page [z]" accesskey="z"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class="generated-sidebar portlet" id="p-navigation">
		<h5>Navigation</h5>
		<div class="pBody">
			<ul>
				<li id="n-mainpage-description"><a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=Main_Page">Main Page</a></li>
				<li id="n-portal"><a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=chipster:Community_Portal" title="About the project, what you can do, where to find things">Community portal</a></li>
				<li id="n-currentevents"><a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=chipster:Current_events" title="Find background information on current events">Current events</a></li>
				<li id="n-recentchanges"><a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=Special:RecentChanges" title="The list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
				<li id="n-randompage"><a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
				<li id="n-help"><a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=Help:Contents" title="The place to find out">Help</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="/apps/mediawiki/chipster/index.php" id="searchform"><div>
				<input name="title" value="Special:Search" type="hidden">
				<input id="searchInput" name="search" title="Search chipster [f]" accesskey="f" type="text">
				<input name="go" class="searchButton" id="searchGoButton" value="Go" title="Go to a page with this exact name if exists" type="submit">&nbsp;
				<input name="fulltext" class="searchButton" id="mw-searchButton" value="Search" title="Search the pages for this text" type="submit">
			</div></form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=Special:WhatLinksHere/TechnicalManual" title="List of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=Special:RecentChangesLinked/TechnicalManual" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
<li id="t-specialpages"><a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=Special:SpecialPages" title="List of all special pages [q]" accesskey="q">Special pages</a></li>
				<li id="t-print"><a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=TechnicalManual&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>				<li id="t-permalink"><a href="http://sourceforge.net/apps/mediawiki/chipster/index.php?title=TechnicalManual&amp;oldid=319" title="Permanent link to this revision of the page">Permanent link</a></li>			</ul>
		</div>
	</div>
		</div><!-- end of the left (by default at least) column -->
			<div class="visualClear"></div>
			<div id="footer">
				<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="SourceForge.net:%20TechnicalManual%20-%20chipster_files/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki"></a></div>
			<ul id="f-list">
					<li id="lastmod"> This page was last modified on 4 December 2013, at 12:49.</li>
					<li id="viewcount">This page has been accessed 2,843 times.</li>
			</ul>
		</div>
</div>

		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
<!-- Served in 0.551 secs. -->
</div></body></html>